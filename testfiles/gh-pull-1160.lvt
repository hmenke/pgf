\documentclass{minimal}
\input{pgf-regression-test}

\RequirePackage{tikz}

\begin{document}

\START

\def\myspecialsauce{\node{specialsauce}}
\def\specialsauceOUTER{outer definition}
\let\UNDEFINED\undefined

\def\test#1{%
  \begin{tikzpicture}
    \specialsauce;
    \node at (0,1) {\AssertEquals\specialsauce#1};
  \end{tikzpicture}%
}

\BEGINTEST{\tikzaddtikzonlycommandshortcutlet, undefined}
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}
  \test{\UNDEFINED}
\ENDTEST

\BEGINTEST{\tikzaddtikzonlycommandshortcutlet, defined before}
  \def\myspecialsauce{\node{specialsauce}}
  \let\specialsauce\specialsauceOUTER
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}
  \test{\specialsauceOUTER}
\ENDTEST

\BEGINTEST{\tikzaddtikzonlycommandshortcutlet, defined after}
  \def\myspecialsauce{\node{specialsauce}}
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}
  \let\specialsauce\specialsauceOUTER
  \test{\specialsauceOUTER}
\ENDTEST

\BEGINTEST{\tikzaddtikzonlycommandshortcutdef, undefined}
  \def\myspecialsauce{\node{specialsauce}}
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}
  \test{\UNDEFINED}
\ENDTEST

\BEGINTEST{\tikzaddtikzonlycommandshortcutdef, defined before}
  \def\myspecialsauce{\node{specialsauce}}
  \let\specialsauce\specialsauceOUTER
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}
  \test{\specialsauceOUTER}
\ENDTEST

\BEGINTEST{\tikzaddtikzonlycommandshortcutdef, defined after}
  \def\myspecialsauce{\node{specialsauce}}
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}
  \let\specialsauce\specialsauceOUTER
  \test{\specialsauceOUTER}
\ENDTEST

\END
